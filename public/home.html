<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="First Chem Pharmacy - Your trusted online pharmacy in South Africa. Quality medications, health products, and wellness solutions at affordable prices.">
    <meta name="keywords" content="online pharmacy, South Africa, medications, health products, wellness, prescriptions, vitamins, supplements">
    <title>FirstChem Pharmacy - Your Trusted Online Pharmacy in South Africa</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Your existing CSS styles */
        :root {
            --primary-color: #1976D2;
            --primary-dark: #1565C0;
            --secondary-color: #f5f7fa;
            --accent-color: #E91E63;
            --accent-light: #F8BBD0;
            --text-color: #333;
            --light-text: #666;
            --white: #ffffff;
            --border-radius: 10px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --box-shadow-lg: 0 10px 15px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            --header-height: 80px;
        }
        
        /* ... rest of your existing CSS ... */
    </style>
</head>
<body>
    <!-- Top Bar -->
    <div class="top-bar">
        <div class="container">
            <div class="welcome-msg">Welcome to FirstChem Pharmacy - South Africa's Trusted Online Pharmacy</div>
            <div class="top-links">
                <ul>
                    <li><a href="tel:0123456789"><i class="fas fa-phone-alt" aria-hidden="true"></i> <span>012 345 6789</span></a></li>
                    <li><a href="mailto:info@firstchempharmacy.co.za"><i class="fas fa-envelope" aria-hidden="true"></i> <span>info@firstchempharmacy.co.za</span></a></li>
                    <li><a href="#store-locator"><i class="fas fa-map-marker-alt" aria-hidden="true"></i> <span>Store Locator</span></a></li>
                </ul>
            </div>
        </div>
    </div>

    <header>
        <div class="main-header">
            <div class="container">
                <div class="header-content">
                    <a href="/" class="logo">
                        <img src="images/FirstChemLogo-removebg-preview-e1751526921499-removebg.png" 
                            alt="FirstChem Logo" 
                            style="height: 100px; width: auto;">
                    </a>

                    <div class="search-bar">
                        <div class="search-container">
                            <label for="searchInput" class="sr-only">Search for medicines and health products</label>
                            <input type="text" id="searchInput" placeholder="Search for medicines and health products..." aria-label="Search products">
                            <div id="searchResults" class="results-dropdown"></div>
                        </div>
                        <button aria-label="Search" id="searchButton"><i class="fas fa-search"></i></button>
                    </div>

                    <div class="header-icons">
                        <a href="#account" class="header-icon" aria-label="My Account">
                            <i class="fas fa-user" aria-hidden="true"></i>
                            <span>Account</span>
                        </a>
                        <a href="#wishlist" class="header-icon" aria-label="Wishlist">
                            <i class="fas fa-heart" aria-hidden="true"></i>
                            <span>Wishlist</span>
                        </a>
                        <div class="header-icon" id="cartIcon" aria-label="Shopping Cart">
                            <div class="icon-wrapper">
                                <i class="fas fa-shopping-cart" aria-hidden="true"></i>
                                <span class="cart-count">0</span>
                            </div>
                            <span>Cart</span>
                            <!-- Cart Dropdown -->
                            <div class="cart-dropdown" id="cartDropdown">
                                <div class="cart-header">
                                    <h3>Your Shopping Cart</h3>
                                </div>
                                <div class="cart-items" id="cartItems">
                                    <!-- Cart items will be inserted here -->
                                </div>
                                <div class="cart-footer">
                                    <div class="cart-total">
                                        <span>Total:</span>
                                        <span id="cartTotalPrice">R0.00</span>
                                    </div>
                                    <div class="cart-buttons">
                                        <a href="cart.html" class="btn btn-view">View Cart</a>
                                        <a href="checkout.html" class="btn btn-checkout">Checkout</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Main Navigation -->
        <nav class="main-nav" aria-label="Main navigation">
            <div class="container">
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li class="nav-dropdown">
                        <a href="shop.html">Shop <i class="fas fa-chevron-down"></i></a>
                        <ul class="dropdown-menu">
                            <li><a href="wound-care.html">Wound Care</a></li>
                            <li><a href="self-medication.html">Self Medication</a></li>
                            <li><a href="vitamins-supplements.html">Vitamins & Supplements</a></li>
                            <!-- ... rest of your navigation items ... -->
                        </ul>
                    </li>
                    <li><a href="prescriptions.html">Prescriptions</a></li>
                    <li><a href="health-wellness.html">Health & Wellness</a></li>
                    <li><a href="baby-kids.html">Baby & Kids</a></li>
                    <li><a href="vitamins-supplements.html">Vitamins & Supplements</a></li>
                    <li><a href="beauty.html">Beauty</a></li>
                    <li><a href="about.html">About Us</a></li>
                    <li><a href="contact.html">Contact</a></li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- Add to cart confirmation -->
    <div class="confirmation" id="confirmation">Product added to cart!</div>

    <!-- Hero Section -->
    <section class="hero" aria-labelledby="hero-heading">
        <div class="container">
            <div class="hero-content">
                <h1 id="hero-heading">Your Health is Our Priority</h1>
                <p>Quality medications and healthcare products at affordable prices</p>
                <div class="hero-btns">
                    <a href="#shop" class="btn">Shop Now</a>
                    <a href="#upload-prescription" class="btn btn-outline">Upload Prescription</a>
                </div>
            </div>
        </div>
    </section>
    
    <!-- Categories Section -->
    <section class="categories">
        <div class="container">
            <div class="category-grid">
                <!-- Your category cards -->
                <div class="category-card">
                    <div class="category-icon">
                        <i class="fas fa-apple-alt"></i>
                    </div>
                    <div class="category-info">
                        <h3>Antioxidants</h3>
                        <span class="count">(32 products)</span>
                        <p>Boost your immune system with powerful antioxidants</p>
                        <a href="antioxidants.html" class="category-link">Shop Now</a>
                    </div>
                </div>
                <!-- ... rest of your category cards ... -->
            </div>
        </div>
    </section>

    <!-- Products Section -->
    <section class="products" aria-labelledby="popular-products-heading">
        <div class="container">
            <div class="section-header">
                <h2 id="popular-products-heading" class="section-title">Popular Products</h2>
                <a href="products.html" class="view-all">View All Products <i class="fas fa-arrow-right"></i></a>
            </div>
            <div class="product-grid">
                <div class="product-card">
                    <div class="product-badge">New</div>
                    <div class="product-img">
                        <img src="Products/Panado_Tablets_1000mg_24s-removebg-preview.png" alt="Panado Tablets">
                        <div class="quick-view" data-product-id="1">Quick View</div>
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">Panado Tablets 1000mg 24s</h3>
                        <p class="product-desc">Fast-acting pain relief for headaches, fever, and mild arthritis pain.</p>
                        <div class="product-price">R49.99</div>
                        <div class="product-rating">
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star"></i>
                            <i class="fas fa-star-half-alt"></i>
                            <span class="rating-count">(128)</span>
                        </div>
                        <button class="add-to-cart" data-id="1">Add to Cart</button>
                    </div>
                </div>
                
                <!-- ... rest of your product cards ... -->
            </div>
        </div>
    </section>
    
    <!-- Product Slideshow Section -->
    <section class="product-slideshow" aria-labelledby="featured-products-heading">
        <div class="container">
            <h2 id="featured-products-heading" class="section-title text-center">Featured Products</h2>
            <div class="slideshow-container">
                <div class="slide active">
                    <div class="slide-content">
                        <div class="slide-image">
                            <img src="Products/Panado_Tablets_1000mg_24s-removebg-preview.png" alt="Panado Tablets">
                        </div>
                        <div class="slide-info">
                            <h3>Panado Tablets 1000mg 24s</h3>
                            <div class="slide-price">R49.99</div>
                            <div class="slide-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                            </div>
                            <p class="slide-description">Effective pain relief for headaches, toothaches, and fever. Contains paracetamol for fast-acting relief. Suitable for adults and children over 12 years. Always read the label and use as directed.</p>
                            <button class="btn add-to-cart" data-id="1">Add to Cart</button>
                        </div>
                    </div>
                </div>
                <!-- ... rest of your slides ... -->
            </div>
            <div class="slideshow-controls">
                <button class="prev-btn" aria-label="Previous product"><i class="fas fa-chevron-left"></i></button>
                <div class="dots-container" role="tablist">
                    <div class="dot active" data-index="0"></div>
                    <div class="dot" data-index="1"></div>
                </div>
                <button class="next-btn" aria-label="Next product"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </section>

    <!-- Script Upload Section -->
    <section id="upload-prescription" class="script-upload" aria-labelledby="script-upload-heading">
        <div class="container">
            <h2 id="script-upload-heading" class="section-title text-center">Upload Your Prescription</h2>
            <div class="upload-container">
                <div class="upload-icon">
                    <i class="fas fa-file-medical"></i>
                </div>
                <h3>Fast & Secure Prescription Processing</h3>
                <p class="upload-instructions">
                    Upload your doctor's prescription and our pharmacists will prepare your medication for pickup or delivery.
                    Supported file types: JPG, PNG, PDF (Max file size: 5MB)
                </p>
                
                <form class="upload-form" id="scriptUploadForm">
                    <div class="file-input-wrapper">
                        <input type="file" id="prescription-file" class="file-input" accept=".jpg,.jpeg,.png,.pdf" required>
                        <label for="prescription-file" class="file-input-label">
                            <i class="fas fa-upload"></i> Select Prescription File
                        </label>
                        <div id="file-name" class="file-name">No file selected</div>
                    </div>
                    
                    <div class="form-group" style="width: 100%; max-width: 400px;">
                        <label for="patient-name" class="sr-only">Patient Name</label>
                        <input type="text" id="patient-name" class="form-control" placeholder="Patient Full Name" required>
                    </div>
                    
                    <div class="form-group" style="width: 100%; max-width: 400px;">
                        <label for="contact-number" class="sr-only">Contact Number</label>
                        <input type="tel" id="contact-number" class="form-control" placeholder="Contact Number" required>
                    </div>
                    
                    <button type="submit" class="upload-btn" id="upload-btn">Upload Prescription</button>
                </form>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features" aria-labelledby="features-heading">
        <div class="container">
            <h2 id="features-heading" class="section-title text-center">Why Choose Us</h2>
            <div class="feature-grid">
                <div class="feature-card">
                    <div class="feature-icon delivery-icon"></div>
                    <h3>Delivery/Pickup Point</h3>
                    <p>On orders over R450 anywhere in South Africa</p>
                </div>
                <!-- ... rest of your feature cards ... -->
            </div>
        </div>
    </section>

    <!-- Newsletter Section -->
    <section class="newsletter" aria-labelledby="newsletter-heading">
        <div class="container">
            <h2 id="newsletter-heading">Subscribe to Our Newsletter</h2>
            <p>Get the latest updates on health tips, special offers and new products directly to your inbox.</p>
            <form class="newsletter-form" id="newsletterForm">
                <label for="newsletter-email" class="sr-only">Email address</label>
                <input type="email" id="newsletter-email" placeholder="Enter your email address" required>
                <button type="submit">Subscribe</button>
            </form>
        </div>
    </section>
    
    <!-- Footer -->
    <footer class="main-footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-col">
                    <h3>First Chem Pharmacy</h3>
                    <p>Your trusted online pharmacy providing quality healthcare products and services since 2010.</p>
                    <div class="social-links">
                        <a href="https://facebook.com" aria-label="Facebook"><i class="fab fa-facebook-f"></i></a>
                        <a href="https://twitter.com" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                        <a href="https://instagram.com" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                        <a href="https://linkedin.com" aria-label="LinkedIn"><i class="fab fa-linkedin-in"></i></a>
                    </div>
                </div>
                <!-- ... rest of your footer content ... -->
            </div>
        </div>
        
        <div class="copyright">
            <div class="container">
                <p>&copy; 2023 First Chem Pharmacy. All Rights Reserved. | <a href="#">Privacy Policy</a> | <a href="#">Terms & Conditions</a></p>
            </div>
        </div>
    </footer>

    <!-- WhatsApp Widget -->
    <div class="whatsapp-widget">
        <div class="whatsapp-btn" id="whatsappBtn">
            <i class="fab fa-whatsapp"></i>
        </div>
        <div class="whatsapp-chat">
            <button class="close-chat" id="closeChat"><i class="fas fa-times"></i></button>
            <div class="chat-header">
                <div class="chat-header-text">
                    <h4>First Chem Pharmacy</h4>
                    <p>Typically replies in minutes</p>
                </div>
            </div>
            <div class="chat-messages">
                <div class="message received">
                    Hello! How can we assist you today?
                </div>
            </div>
            <div class="chat-input">
                <input type="text" placeholder="Type a message...">
                <button id="sendMessage"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>
    
    <!-- Quick View Modal -->
    <div class="quick-view-modal" id="quickViewModal">
        <div class="quick-view-content">
            <button class="close-quick-view" id="closeQuickView">&times;</button>
            <div class="quick-view-flex" id="quickViewContent">
                <!-- Content will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
        import { 
            getAuth, 
            onAuthStateChanged,
            signInWithEmailAndPassword 
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
        import { 
            getFirestore, 
            doc, 
            getDoc, 
            setDoc,
            updateDoc,
            arrayUnion,
            arrayRemove
        } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";



        // Firebase configuration - REPLACE WITH YOUR ACTUAL CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyA5XW1vHLse1PGK7dm5qk8ZyBjsV5C5-pE",
            authDomain: "project1-4f792",
            projectId: "project1-4f792.firebasestorage.app",
            storageBucket: "your-app.appspot.com",
            messagingSenderId: "344555024974",
            appId: "1:344555024974:web:874b458f564085b164491f"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Product database
        const products = [
            {
                id: 1,
                name: "Panado Tablets 1000mg 24s",
                price: 49.99,
                image: "Products/Panado_Tablets_1000mg_24s-removebg-preview.png",
                description: "Fast-acting pain relief for headaches, fever, and mild arthritis pain."
            },
            {
                id: 2,
                name: "Disprin Tablets 300mg 24s",
                price: 39.99,
                image: "Products/Disprin_Tablets_300mg_24s-removebg-preview.png",
                description: "Effervescent pain reliever that works quickly to reduce pain and inflammation."
            },
            {
                id: 3,
                name: "Vitamin C 1000mg 60 Tablets",
                price: 129.99,
                image: "Products/Very_Well_Vitamin_C_1000mg_60_Tablets-removebg-preview.png",
                description: "Boosts immune system and promotes healthy skin with high-potency Vitamin C."
            },
            {
                id: 4,
                name: "Pampers Baby Dry Size 3 60s",
                price: 249.99,
                image: "Products/Pampers_Baby_Dry_Size_3_98-removebg-preview.png",
                description: "Premium diapers with 12-hour leak protection and wetness indicator."
            }
        ];

        // Save cart to Firestore
        async function saveCartToFirestore(cart) {
            const user = auth.currentUser;
            if (!user) return;

            try {
                const userRef = doc(db, "users", user.uid);
                await setDoc(userRef, { cart }, { merge: true });
            } catch (error) {
                console.error("Error saving cart:", error);
            }
        }

        // Load cart from Firestore
        async function loadCartFromFirestore() {
            const user = auth.currentUser;
            if (!user) return [];

            try {
                const userRef = doc(db, "users", user.uid);
                const docSnap = await getDoc(userRef);
                
                if (docSnap.exists() && docSnap.data().cart) {
                    return docSnap.data().cart;
                }
                return [];
            } catch (error) {
                console.error("Error loading cart:", error);
                return [];
            }
        }

        // Add item to cart
        async function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return;

            let cart = await loadCartFromFirestore();
            const existingItem = cart.find(item => item.id === productId);

            if (existingItem) {
                existingItem.quantity++;
            } else {
                cart.push({
                    id: product.id,
                    name: product.name,
                    price: product.price,
                    image: product.image,
                    quantity: 1
                });
            }

            await saveCartToFirestore(cart);
            updateCartDisplay(cart);
            showAddToCartConfirmation(product.name);
        }

        // Remove item from cart
        async function removeFromCart(productId) {
            let cart = await loadCartFromFirestore();
            cart = cart.filter(item => item.id !== productId);
            
            await saveCartToFirestore(cart);
            updateCartDisplay(cart);
        }

        // Update item quantity
        async function updateCartItemQuantity(productId, change) {
            let cart = await loadCartFromFirestore();
            const item = cart.find(item => item.id === productId);

            if (item) {
                item.quantity += change;
                
                if (item.quantity <= 0) {
                    cart = cart.filter(item => item.id !== productId);
                }

                await saveCartToFirestore(cart);
                updateCartDisplay(cart);
            }
        }

        // Update cart display
        function updateCartDisplay(cart) {
            const cartCount = document.querySelector('.cart-count');
            const cartItemsContainer = document.getElementById('cartItems');
            const cartTotalPrice = document.getElementById('cartTotalPrice');

            // Update cart count
            const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;

            // Update cart items display
            if (cart.length === 0) {
                cartItemsContainer.innerHTML = `
                    <div class="empty-cart">
                        <i class="fas fa-shopping-cart"></i>
                        <p>Your cart is empty</p>
                    </div>
                `;
                cartTotalPrice.textContent = 'R0.00';
            } else {
                cartItemsContainer.innerHTML = '';
                let totalPrice = 0;
                
                cart.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    totalPrice += itemTotal;
                    
                    const cartItem = document.createElement('div');
                    cartItem.className = 'cart-item';
                    cartItem.innerHTML = `
                        <img src="${item.image}" alt="${item.name}">
                        <div class="cart-item-info">
                            <div class="cart-item-title">${item.name}</div>
                            <div class="cart-item-price">R${item.price.toFixed(2)}</div>
                            <div class="cart-item-quantity">
                                <button class="quantity-btn minus" data-id="${item.id}">-</button>
                                <span class="quantity-value">${item.quantity}</span>
                                <button class="quantity-btn plus" data-id="${item.id}">+</button>
                                <button class="remove-item" data-id="${item.id}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    `;
                    cartItemsContainer.appendChild(cartItem);
                });
                
                cartTotalPrice.textContent = `R${totalPrice.toFixed(2)}`;
            }

            // Add event listeners to the new buttons
            document.querySelectorAll('.quantity-btn.minus').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.dataset.id);
                    updateCartItemQuantity(id, -1);
                });
            });
            
            document.querySelectorAll('.quantity-btn.plus').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.dataset.id);
                    updateCartItemQuantity(id, 1);
                });
            });
            
            document.querySelectorAll('.remove-item').forEach(button => {
                button.addEventListener('click', () => {
                    const id = parseInt(button.dataset.id);
                    removeFromCart(id);
                });
            });
        }

        // Show add to cart confirmation
        function showAddToCartConfirmation(productName) {
            const confirmation = document.getElementById('confirmation');
            confirmation.textContent = `${productName} added to cart!`;
            confirmation.style.display = 'block';
            
            setTimeout(() => {
                confirmation.style.display = 'none';
            }, 3000);
        }

        // Initialize cart when page loads and auth state changes
        onAuthStateChanged(auth, async (user) => {
            if (user) {
                // User is signed in, load cart from Firestore
                const cart = await loadCartFromFirestore();
                updateCartDisplay(cart);
            } else {
                // User is signed out, clear cart display
                updateCartDisplay([]);
            }
        });

        // Event listeners
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize with empty cart
            updateCartDisplay([]);

            // Add to cart buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('add-to-cart')) {
                    const productId = parseInt(e.target.dataset.id);
                    addToCart(productId);
                }
            });

            // Cart icon toggle
            const cartIcon = document.getElementById('cartIcon');
            const cartDropdown = document.getElementById('cartDropdown');
            
            cartIcon.addEventListener('click', function(e) {
                e.stopPropagation();
                cartDropdown.style.display = cartDropdown.style.display === 'block' ? 'none' : 'block';
            });

            // Close cart when clicking outside
            document.addEventListener('click', function(e) {
                if (!cartIcon.contains(e.target) && !cartDropdown.contains(e.target)) {
                    cartDropdown.style.display = 'none';
                }
            });

            // Search functionality
            const searchInput = document.getElementById('searchInput');
            const resultsContainer = document.getElementById('searchResults');
            const searchButton = document.getElementById('searchButton');
            
            // Product data for search
            const productsData = [
                { id: 1, title: "Panado Tablets 1000mg 24s", category: "Pain Relief", price: "R49.99", keywords: "pain relief headache fever" },
                { id: 2, title: "Disprin Tablets 300mg 24s", category: "Pain Relief", price: "R39.99", keywords: "aspirin pain fever" },
                { id: 3, title: "Vitamin C 1000mg 60 Tablets", category: "Vitamins", price: "R129.99", keywords: "immune health antioxidant" },
                { id: 4, title: "Pampers Baby Dry Size 3 60s", category: "Baby Care", price: "R249.99", keywords: "diapers baby care" }
            ];
            
            function searchProducts(term) {
                term = term.toLowerCase();
                return productsData.filter(product => 
                    product.title.toLowerCase().includes(term) ||
                    product.category.toLowerCase().includes(term) ||
                    product.keywords.toLowerCase().includes(term)
                );
            }
            
            function displayResults(results) {
                resultsContainer.innerHTML = '';
                if (results.length === 0) {
                    resultsContainer.innerHTML = '<div class="result-item">No products found</div>';
                    resultsContainer.style.display = 'block';
                    return;
                }
                
                results.forEach(item => {
                    const resultItem = document.createElement('a');
                    resultItem.href = '#';
                    resultItem.className = 'result-item';
                    resultItem.innerHTML = `
                        <strong>${item.title}</strong>
                        <span>${item.category}</span>
                        <small>${item.price}</small>
                    `;
                    resultsContainer.appendChild(resultItem);
                    
                    resultItem.addEventListener('click', (e) => {
                        e.preventDefault();
                        resultsContainer.style.display = 'none';
                        searchInput.value = '';
                        
                        const productElement = document.querySelector(`.product-card:nth-child(${products.findIndex(p => p.id === item.id) + 1})`);
                        if (productElement) {
                            productElement.scrollIntoView({ behavior: 'smooth' });
                            productElement.style.boxShadow = '0 0 0 3px #3498db';
                            setTimeout(() => {
                                productElement.style.boxShadow = '';
                            }, 2000);
                        }
                    });
                });
                
                resultsContainer.style.display = 'block';
            }
            
            searchInput.addEventListener('input', function() {
                const term = this.value.trim();
                if (term.length < 2) {
                    resultsContainer.style.display = 'none';
                    return;
                }
                const results = searchProducts(term);
                displayResults(results);
            });
            
            searchButton.addEventListener('click', function() {
                const term = searchInput.value.trim();
                if (term.length < 2) return;
                const results = searchProducts(term);
                if (results.length === 1) {
                    const productElement = document.querySelector(`.product-card:nth-child(${products.findIndex(p => p.id === results[0].id) + 1})`);
                    if (productElement) {
                        productElement.scrollIntoView({ behavior: 'smooth' });
                        productElement.style.boxShadow = '0 0 0 3px #3498db';
                        setTimeout(() => {
                            productElement.style.boxShadow = '';
                        }, 2000);
                    }
                } else {
                    displayResults(results);
                }
            });
            
            document.addEventListener('click', function(e) {
                if (!searchInput.contains(e.target) && !resultsContainer.contains(e.target)) {
                    resultsContainer.style.display = 'none';
                }
            });

            // Slideshow functionality
            const slides = document.querySelectorAll('.slide');
            const dots = document.querySelectorAll('.dot');
            const prevBtn = document.querySelector('.prev-btn');
            const nextBtn = document.querySelector('.next-btn');
            let currentSlide = 0;
            
            function showSlide(index) {
                slides.forEach(slide => slide.classList.remove('active'));
                dots.forEach(dot => dot.classList.remove('active'));
                
                slides[index].classList.add('active');
                dots[index].classList.add('active');
                currentSlide = index;
            }
            
            function nextSlide() {
                let nextIndex = (currentSlide + 1) % slides.length;
                showSlide(nextIndex);
            }
            
            function prevSlide() {
                let prevIndex = (currentSlide - 1 + slides.length) % slides.length;
                showSlide(prevIndex);
            }
            
            nextBtn.addEventListener('click', nextSlide);
            prevBtn.addEventListener('click', prevSlide);
            
            dots.forEach((dot, index) => {
                dot.addEventListener('click', () => showSlide(index));
            });
            
            // Auto-advance slides
            setInterval(nextSlide, 5000);

            // WhatsApp Widget
            const whatsappBtn = document.getElementById('whatsappBtn');
            const closeChat = document.getElementById('closeChat');
            const whatsappWidget = document.querySelector('.whatsapp-widget');
            const sendMessageBtn = document.getElementById('sendMessage');
            const chatInput = document.querySelector('.chat-input input');
            const chatMessages = document.querySelector('.chat-messages');
            
            whatsappBtn.addEventListener('click', function() {
                whatsappWidget.classList.toggle('active');
            });
            
            closeChat.addEventListener('click', function(e) {
                e.stopPropagation();
                whatsappWidget.classList.remove('active');
            });
            
            sendMessageBtn.addEventListener('click', function() {
                const messageText = chatInput.value.trim();
                if (messageText) {
                    const messageElement = document.createElement('div');
                    messageElement.className = 'message sent';
                    messageElement.textContent = messageText;
                    chatMessages.appendChild(messageElement);
                    
                    chatInput.value = '';
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                    
                    setTimeout(() => {
                        const replyElement = document.createElement('div');
                        replyElement.className = 'message received';
                        replyElement.textContent = "Thanks for your message! Our team will respond shortly. For immediate assistance, you can also call us at +27 68 001 7270.";
                        chatMessages.appendChild(replyElement);
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }, 1000);
                }
            });

            // Prescription upload
            const scriptUploadForm = document.getElementById('scriptUploadForm');
            const fileInput = document.getElementById('prescription-file');
            const fileNameDisplay = document.getElementById('file-name');
            const uploadBtn = document.getElementById('upload-btn');
            
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    fileNameDisplay.textContent = this.files[0].name;
                } else {
                    fileNameDisplay.textContent = 'No file selected';
                }
            });
            
            scriptUploadForm.addEventListener('submit', function(e) {
                e.preventDefault();
                
                uploadBtn.disabled = true;
                uploadBtn.textContent = 'Uploading...';
                
                setTimeout(() => {
                    alert('Prescription uploaded successfully! Our pharmacists will process your order shortly, We will contact you through Whatsapp.');
                    scriptUploadForm.reset();
                    fileNameDisplay.textContent = 'No file selected';
                    uploadBtn.disabled = false;
                    uploadBtn.textContent = 'Upload Prescription';
                }, 1500);
            });
            
            // Newsletter form
            const newsletterForm = document.getElementById('newsletterForm');
            newsletterForm.addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('newsletter-email').value;
                alert(`Thank you for subscribing with ${email}! You'll receive our newsletter soon.`);
                this.reset();
            });

            // Quick View Functionality
            const quickViewButtons = document.querySelectorAll('.quick-view');
            const modal = document.getElementById('quickViewModal');
            const closeButton = document.getElementById('closeQuickView');
            const modalContent = document.getElementById('quickViewContent');
            
            // Product details for quick view
            const productsQuickView = {
                1: {
                    title: "Panado Tablets 1000mg 24s",
                    price: "R49.99",
                    description: "Fast-acting pain relief for headaches, fever, and mild arthritis pain. Contains paracetamol which works to block pain signals to the brain. Suitable for adults and children over 12 years. Always read the label and use as directed.",
                    image: "Products/Panado_Tablets_1000mg_24s-removebg-preview.png",
                    rating: 4.5,
                    ratingCount: 128,
                    category: "Pain Relief",
                    sku: "PAN1000-24",
                    stock: "In Stock"
                },
                2: {
                    title: "Disprin Tablets 300mg 24s",
                    price: "R70.99",
                    oldPrice: "R49.99",
                    description: "Effervescent pain reliever that works quickly to reduce pain and inflammation. Contains aspirin which helps to reduce substances in the body that cause pain and inflammation. Ideal for headaches, period pain, and mild arthritis.",
                    image: "Products/Disprin_Tablets_300mg_24s-removebg-preview.png",
                    rating: 4.0,
                    ratingCount: 95,
                    category: "Pain Relief",
                    sku: "DISP300-24",
                    stock: "In Stock"
                },
                3: {
                    title: "Vitamin C 1000mg 60 Tablets",
                    price: "R129.99",
                    description: "Boosts immune system and promotes healthy skin with high-potency Vitamin C. Essential for the growth and repair of tissues in all parts of your body. Helps the body make collagen, an important protein used to make skin, cartilage, tendons, ligaments, and blood vessels.",
                    image: "Products/Very_Well_Vitamin_C_1000mg_60_Tablets-removebg-preview.png",
                    rating: 5.0,
                    ratingCount: 210,
                    category: "Vitamins & Supplements",
                    sku: "VITC1000-60",
                    stock: "In Stock"
                },
                4: {
                    title: "Pampers Baby Dry Size 3 60s",
                    price: "R249.99",
                    description: "Premium diapers with 12-hour leak protection and wetness indicator. Features Air Channels that help distribute wetness for up to 12 hours of overnight protection. Wetness indicator lets you know when baby might need a change.",
                    image: "Products/Pampers_Baby_Dry_Size_3_98-removebg-preview.png",
                    rating: 4.5,
                    ratingCount: 187,
                    category: "Baby Care",
                    sku: "PAMP3-60",
                    stock: "In Stock"
                }
            };
            
            // Show quick view on hover
            const productCards = document.querySelectorAll('.product-card');
            productCards.forEach(card => {
                card.addEventListener('mouseenter', () => {
                    const quickView = card.querySelector('.quick-view');
                    quickView.style.bottom = '0';
                    quickView.style.opacity = '1';
                });
                
                card.addEventListener('mouseleave', () => {
                    const quickView = card.querySelector('.quick-view');
                    quickView.style.bottom = '-40px';
                    quickView.style.opacity = '0';
                });
            });
            
            // Add click event to quick view buttons
            quickViewButtons.forEach(button => {
                button.addEventListener('click', (e) => {
                    e.preventDefault();
                    const productId = button.getAttribute('data-product-id');
                    showQuickView(productId);
                });
            });
            
            // Close modal when clicking close button
            closeButton.addEventListener('click', () => {
                modal.style.display = 'none';
            });
            
            // Close modal when clicking outside content
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.style.display = 'none';
                }
            });
            
            // Function to show quick view
            function showQuickView(productId) {
                const product = productsQuickView[productId];
                if (!product) return;
                
                let starsHtml = '';
                const fullStars = Math.floor(product.rating);
                const halfStar = product.rating % 1 >= 0.5;
                
                for (let i = 0; i < fullStars; i++) {
                    starsHtml += '<i class="fas fa-star"></i>';
                }
                
                if (halfStar) {
                    starsHtml += '<i class="fas fa-star-half-alt"></i>';
                }
                
                const emptyStars = 5 - fullStars - (halfStar ? 1 : 0);
                for (let i = 0; i < emptyStars; i++) {
                    starsHtml += '<i class="far fa-star"></i>';
                }
                
                modalContent.innerHTML = `
                    <div class="quick-view-img">
                        <img src="${product.image}" alt="${product.title}">
                    </div>
                    <div class="quick-view-details">
                        <h3>${product.title}</h3>
                        <div class="quick-view-price">
                            ${product.oldPrice ? `<span style="text-decoration: line-through; color: #999; margin-right: 10px;">${product.oldPrice}</span>` : ''}
                            ${product.price}
                        </div>
                        <div class="quick-view-rating">
                            ${starsHtml}
                            <span class="rating-count" style="color: #666; font-size: 1rem; margin-left: 10px;">(${product.ratingCount})</span>
                        </div>
                        <p class="quick-view-description">${product.description}</p>
                        <div style="margin-bottom: 1rem;">
                            <strong>Category:</strong> ${product.category}<br>
                            <strong>SKU:</strong> ${product.sku}<br>
                            <strong>Availability:</strong> ${product.stock}
                        </div>
                        <div class="quick-view-actions">
                            <button class="add-to-cart-large" data-id="${productId}">
                                <i class="fas fa-shopping-cart"></i> Add to Cart
                            </button>
                            <button class="view-details">
                                View Full Details
                            </button>
                        </div>
                    </div>
                `;
                
                modal.style.display = 'flex';
                
                const addToCartBtn = modalContent.querySelector('.add-to-cart-large');
                addToCartBtn.addEventListener('click', function() {
                    const id = parseInt(this.dataset.id);
                    addToCart(id);
                    modal.style.display = 'none';
                });
            }
        });

        // Login function
        window.login = async function(event) {
            event.preventDefault();
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            
            try {
                await signInWithEmailAndPassword(auth, email, password);
                // Cart will automatically update via onAuthStateChanged
            } catch (error) {
                alert("Login failed: " + error.message);
            }
        };
    </script>
</body>
</html>